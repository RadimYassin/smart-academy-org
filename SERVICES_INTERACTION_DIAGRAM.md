# ğŸ”„ Smart Academy Platform - Services Interaction Diagrams

## Overview

This document provides visual diagrams of how services interact in the Smart Academy Platform.

---

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENT LAYER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Auth   â”‚  â”‚Dashboard â”‚  â”‚ Courses  â”‚  â”‚  Shell   â”‚              â”‚
â”‚  â”‚  (5002)  â”‚  â”‚  (5003)  â”‚  â”‚  (5004)  â”‚  â”‚  (5001)  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
â”‚       â”‚             â”‚             â”‚             â”‚                      â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                          â”‚                                              â”‚
â”‚                    (PostMessage)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP/REST
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API GATEWAY                                      â”‚
â”‚                      (Spring Cloud)                                      â”‚
â”‚                         Port: 8888                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Routes:                                                          â”‚  â”‚
â”‚  â”‚  /user-management-service/** â†’ User-Management                   â”‚  â”‚
â”‚  â”‚  /course-service/** â†’ Course-Management                          â”‚  â”‚
â”‚  â”‚  /lmsconnector/** â†’ LMS Connector                                â”‚  â”‚
â”‚  â”‚  /prepadata-service/** â†’ PrepaData                               â”‚  â”‚
â”‚  â”‚  /studentprofiler-service/** â†’ StudentProfiler                   â”‚  â”‚
â”‚  â”‚  /pathpredictor-service/** â†’ PathPredictor                       â”‚  â”‚
â”‚  â”‚  /recobuilder-service/** â†’ RecoBuilder                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Service Discovery
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EUREKA SERVER                                       â”‚
â”‚                      Port: 8761                                          â”‚
â”‚            (Service Registry & Discovery)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚               â”‚               â”‚               â”‚
            â”‚               â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER-MANAGEMENT   â”‚ â”‚   COURSE   â”‚ â”‚    LMS     â”‚ â”‚  AI SERVICES   â”‚
â”‚   (Spring Boot)    â”‚ â”‚ MANAGEMENT â”‚ â”‚ CONNECTOR  â”‚ â”‚   (FastAPI)    â”‚
â”‚     Port: 8082     â”‚ â”‚ (Spring)   â”‚ â”‚  (NestJS)  â”‚ â”‚                â”‚
â”‚                    â”‚ â”‚ Port: 8081 â”‚ â”‚ Port: 3000 â”‚ â”‚ Ports: 8001-4  â”‚
â”‚  â€¢ Registration    â”‚ â”‚            â”‚ â”‚            â”‚ â”‚                â”‚
â”‚  â€¢ Authentication  â”‚ â”‚ â€¢ Courses  â”‚ â”‚ â€¢ Moodle   â”‚ â”‚ â€¢ PrepaData    â”‚
â”‚  â€¢ JWT Generation  â”‚ â”‚ â€¢ Modules  â”‚ â”‚ â€¢ Sync     â”‚ â”‚ â€¢ Profiling    â”‚
â”‚  â€¢ User CRUD       â”‚ â”‚ â€¢ Lessons  â”‚ â”‚ â€¢ Normalizeâ”‚ â”‚ â€¢ Prediction   â”‚
â”‚                    â”‚ â”‚ â€¢ Quizzes  â”‚ â”‚            â”‚ â”‚ â€¢ Recommend    â”‚
â”‚  DB: PostgreSQL    â”‚ â”‚            â”‚ â”‚            â”‚ â”‚                â”‚
â”‚    (Port: 5435)    â”‚ â”‚ DB:        â”‚ â”‚ DB:        â”‚ â”‚ DB:            â”‚
â”‚                    â”‚ â”‚ PostgreSQL â”‚ â”‚ PostgreSQL â”‚ â”‚ (Future)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚         â”‚Shell â”‚         â”‚   Gateway    â”‚         â”‚   User      â”‚
â”‚          â”‚         â”‚(5001)â”‚         â”‚   (8888)     â”‚         â”‚ Management  â”‚
â”‚          â”‚         â”‚      â”‚         â”‚              â”‚         â”‚   (8082)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚ 1. Fill Login    â”‚                     â”‚                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚ 2. AUTH_LOGIN    â”‚                     â”‚                        â”‚
     â”‚    postMessage   â”‚                     â”‚                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚ 3. POST /auth/login â”‚                        â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚ 4. Route to User-Mgmt  â”‚
     â”‚                  â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚ 5. Validate credentialsâ”‚
     â”‚                  â”‚                     â”‚    Generate JWT        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚ 6. JWT + Refresh Token â”‚
     â”‚                  â”‚                     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚ 7. Return JWT       â”‚                        â”‚
     â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚ 8. Store tokens  â”‚                     â”‚                        â”‚
     â”‚    Update state  â”‚                     â”‚                        â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚ 9. Redirect      â”‚                     â”‚                        â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                        â”‚
```

---

## Course Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Teacher  â”‚         â”‚Shell â”‚         â”‚   Gateway    â”‚         â”‚   Course    â”‚
â”‚          â”‚         â”‚(5001)â”‚         â”‚   (8888)     â”‚         â”‚ Management  â”‚
â”‚          â”‚         â”‚      â”‚         â”‚              â”‚         â”‚   (8081)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚ 1. Create Course â”‚                     â”‚                        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚ 2. CREATE_COURSE    â”‚                        â”‚
     â”‚                  â”‚    postMessage      â”‚                        â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚ 3. POST /courses    â”‚                        â”‚
     â”‚                  â”‚    + JWT Header     â”‚                        â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚ 4. Validate JWT & Role â”‚
     â”‚                  â”‚                     â”‚    Route to Course-Mgmtâ”‚
     â”‚                  â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚ 5. Create course       â”‚
     â”‚                  â”‚                     â”‚    Save to DB          â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚                     â”‚ 6. Return course data  â”‚
     â”‚                  â”‚                     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚                  â”‚ 7. Return response  â”‚                        â”‚
     â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
     â”‚                  â”‚                     â”‚                        â”‚
     â”‚ 8. Update UI     â”‚                     â”‚                        â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                        â”‚
```

---

## Student Risk Prediction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Teacher  â”‚    â”‚Shell â”‚    â”‚ Gateway  â”‚    â”‚  PathPredict â”‚    â”‚  PrepaData   â”‚    â”‚   XGBoost    â”‚
â”‚          â”‚    â”‚      â”‚    â”‚          â”‚    â”‚    (8003)    â”‚    â”‚    (8001)    â”‚    â”‚    Model     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚ 1. Request  â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚    Risk     â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚ 2. GET       â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚    /predict- â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚    risk/{id} â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                  â”‚                   â”‚                    â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚              â”‚ 3. Route         â”‚                   â”‚                    â”‚
     â”‚             â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚              â”‚                  â”‚ 4. Get student    â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚    engagement     â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚    data           â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 5. Return stats   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 6. Load model     â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚    (MLflow)       â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚             â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚              â”‚                  â”‚ 7. Predict        â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚             â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚             â”‚              â”‚ 8. Return risk   â”‚                   â”‚                    â”‚
     â”‚             â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚                    â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚ 9. Display  â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚    results  â”‚              â”‚                  â”‚                   â”‚                    â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚                  â”‚                   â”‚                    â”‚
```

---

## LMS Data Synchronization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Teacher  â”‚    â”‚Shell â”‚    â”‚ Gateway  â”‚    â”‚   LMS        â”‚    â”‚    Moodle    â”‚
â”‚          â”‚    â”‚      â”‚    â”‚          â”‚    â”‚ Connector    â”‚    â”‚    (External)â”‚
â”‚          â”‚    â”‚      â”‚    â”‚          â”‚    â”‚   (3000)     â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚ 1. Trigger  â”‚              â”‚                  â”‚                   â”‚
     â”‚    Sync     â”‚              â”‚                  â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚                  â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚             â”‚ 2. POST      â”‚                  â”‚                   â”‚
     â”‚             â”‚    /sync-    â”‚                  â”‚                   â”‚
     â”‚             â”‚    course-   â”‚                  â”‚                   â”‚
     â”‚             â”‚    students/ â”‚                  â”‚                   â”‚
     â”‚             â”‚    {courseId}â”‚                  â”‚                   â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                  â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚             â”‚              â”‚ 3. Route         â”‚                   â”‚
     â”‚             â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 4. Authenticate   â”‚
     â”‚             â”‚              â”‚                  â”‚    (OAuth2)       â”‚
     â”‚             â”‚              â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 5. Fetch enrolled â”‚
     â”‚             â”‚              â”‚                  â”‚    users          â”‚
     â”‚             â”‚              â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 6. Store raw data â”‚
     â”‚             â”‚              â”‚                  â”‚    (RowData)      â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 7. Normalize &    â”‚
     â”‚             â”‚              â”‚                  â”‚    store students â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚             â”‚              â”‚ 8. Return sync   â”‚                   â”‚
     â”‚             â”‚              â”‚    status        â”‚                   â”‚
     â”‚             â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚
     â”‚ 9. Show     â”‚              â”‚                  â”‚                   â”‚
     â”‚    success  â”‚              â”‚                  â”‚                   â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚                  â”‚                   â”‚
```

---

## Recommendation Generation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Student  â”‚    â”‚Shell â”‚    â”‚ Gateway  â”‚    â”‚  RecoBuilder â”‚    â”‚ StudentProf. â”‚    â”‚  PrepaData   â”‚
â”‚          â”‚    â”‚      â”‚    â”‚          â”‚    â”‚    (8004)    â”‚    â”‚    (8002)    â”‚    â”‚    (8001)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚ 1. Request  â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚    Recomms  â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚ 2. GET       â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚    /recommendâ”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚    /{id}     â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚ 3. Route         â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 4. Get profile    â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 5. Return profile â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 6. Get gaps       â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 7. Return gaps    â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚ 8. BERT embed +   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚    Faiss match    â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚ 9. Return        â”‚                   â”‚                   â”‚
     â”‚             â”‚              â”‚    recommendations                   â”‚                   â”‚
     â”‚             â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚                   â”‚
     â”‚             â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚ 10. Display â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚    results  â”‚              â”‚                  â”‚                   â”‚                   â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚                  â”‚                   â”‚                   â”‚
```

---

## Service Discovery (Eureka) Registration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Startup â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Initialize
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Register with Eureka   â”‚
â”‚ (Self-registration)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. POST /eureka/apps/{service-name}
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Eureka Server        â”‚
â”‚   (Port 8761)          â”‚
â”‚                        â”‚
â”‚  - Store service info  â”‚
â”‚  - Health check        â”‚
â”‚  - Heartbeat           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. Service Registry Updated
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway queries       â”‚
â”‚  Eureka for routes     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Services Register:**
- User-Management (8082)
- Course-Management (8081)
- LMS Connector (3000)
- PrepaData (8001)
- StudentProfiler (8002)
- PathPredictor (8003)
- RecoBuilder (8004)

---

## Data Flow: LMS to AI Services

```
Moodle LMS
    â”‚
    â”‚ OAuth2
    â–¼
LMS Connector (NestJS)
    â”‚
    â”‚ Store Raw Data
    â”œâ”€â”€â”€â–º RowData Table (JSONB)
    â”‚
    â”‚ Normalize
    â”œâ”€â”€â”€â–º Student Table
    â”‚
    â”‚ Enrollments
    â””â”€â”€â”€â–º Enrollment Table
           â”‚
           â”‚ HTTP Call (via Gateway)
           â–¼
    PrepaData Service
           â”‚
           â”‚ Process & Aggregate
           â”œâ”€â”€â”€â–º Engagement Stats
           â”‚
           â”‚ HTTP Call
           â”œâ”€â”€â”€â–º StudentProfiler
           â”‚         â”‚
           â”‚         â””â”€â”€â”€â–º Profile (Clustering)
           â”‚
           â”‚ HTTP Call
           â”œâ”€â”€â”€â–º PathPredictor
           â”‚         â”‚
           â”‚         â””â”€â”€â”€â–º Risk Prediction (XGBoost)
           â”‚
           â”‚ HTTP Call
           â””â”€â”€â”€â–º RecoBuilder
                     â”‚
                     â””â”€â”€â”€â–º Recommendations (BERT/Faiss)
```

---

## JWT Token Validation Flow (Cross-Service)

```
Client Request with JWT
    â”‚
    â–¼
API Gateway
    â”‚
    â”‚ Forward JWT in Header
    â–¼
Microservice (Any)
    â”‚
    â”‚ Extract JWT from Header
    â–¼
JWT Validator
    â”‚
    â”œâ”€â”€â”€â–º Spring Boot: JwtAuthenticationFilter
    â”‚         â”‚
    â”‚         â””â”€â”€â”€â–º JwtService.validate()
    â”‚
    â”œâ”€â”€â”€â–º NestJS: JwtStrategy (Passport)
    â”‚         â”‚
    â”‚         â””â”€â”€â”€â–º jwt.verify()
    â”‚
    â””â”€â”€â”€â–º Python: verify_token() dependency
              â”‚
              â””â”€â”€â”€â–º jwt.decode() with shared secret
                        â”‚
                        â”œâ”€â”€â”€â–º Check expiration
                        â”œâ”€â”€â”€â–º Validate signature
                        â””â”€â”€â”€â–º Extract claims (sub, roles)
                                 â”‚
                                 â–¼
                          Authentication Success
                          (Set Security Context)
```

**Shared Secret**: All services use the same JWT secret key for validation.

---

## Microfrontend Communication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Browser                             â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Shell (Host App)                      â”‚ â”‚
â”‚  â”‚  Port: 5001                                        â”‚ â”‚
â”‚  â”‚  - AuthContext                                     â”‚ â”‚
â”‚  â”‚  - ThemeContext                                    â”‚ â”‚
â”‚  â”‚  - API Services                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                                         â”‚
â”‚                â”‚ Loads via iframe                        â”‚
â”‚                â”‚                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚           â”‚           â”‚              â”‚            â”‚
â”‚    â–¼           â–¼           â–¼              â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Auth â”‚  â”‚Dash- â”‚   â”‚Courseâ”‚      â”‚Other â”‚         â”‚
â”‚  â”‚ 5002 â”‚  â”‚board â”‚   â”‚ 5004 â”‚      â”‚MFEs  â”‚         â”‚
â”‚  â”‚      â”‚  â”‚ 5003 â”‚   â”‚      â”‚      â”‚      â”‚         â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”˜      â””â”€â”€â”€â”¬â”€â”€â”˜         â”‚
â”‚      â”‚         â”‚           â”‚              â”‚            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                â”‚                                         â”‚
â”‚                â”‚ postMessage()                          â”‚
â”‚                â”‚                                         â”‚
â”‚                â–¼                                         â”‚
â”‚        Shell Event Handler                              â”‚
â”‚                â”‚                                         â”‚
â”‚                â”‚ Makes API call to Gateway              â”‚
â”‚                â–¼                                         â”‚
â”‚        Backend Services                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Message Types:
- AUTH_LOGIN, AUTH_REGISTER
- FETCH_TEACHER_COURSES, CREATE_COURSE
- PREDICT_RISK, GET_RECOMMENDATIONS
- THEME_CHANGE, PAGE_CHANGE
```

---

These diagrams illustrate the complex interactions between services in the Smart Academy Platform. Each service maintains its independence while communicating through well-defined interfaces and protocols.

